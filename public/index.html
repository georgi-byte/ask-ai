<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI Mental Health Companion</title>
  <style>
    body { font-family: Arial, sans-serif; background: linear-gradient(to bottom, #e0f7fa, #80deea); display:flex; justify-content:center; align-items:center; height:100vh; margin:0; color:#333; overflow:hidden; }
    .container { background: rgba(255,255,255,0.9); padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); width:400px; text-align:center; }
    .chat-box{ border:1px solid #ccc; height:300px; overflow-y:auto; margin:10px 0; padding:10px; background:#f9f9f9; border-radius:5px; }
    .message{ margin:5px 10px; padding:8px; border-radius:5px; max-width:70%; }
    .user{ background:#e0f7fa; margin-left:auto; text-align:right; }
    .bot{ background:#fff; margin-right:auto; text-align:left; }
    input[type="text"]{ width:70%; padding:8px; margin:5px; border:1px solid #ccc; border-radius:5px; }
    button{ padding:8px 15px; margin:5px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; }
    #sendMessageBtn{ background:#26a69a; color:white; }
    #logMoodBtn{ background:#66bb6a; color:white; }
    #oracleBtn{ background:#ff9800; color:white; }
    #gardenBtn{ background:#4caf50; color:white; }
  </style>
</head>
<body>
<div class="container">
  <h1 id="appTitle">AI Mental Health Companion</h1>
  <div class="chat-box" id="chatBox"></div>
  <input type="text" id="userInput" placeholder="How are you feeling?">
  <button id="sendMessageBtn">Send</button>
  <input type="text" id="moodInput" placeholder="Log your mood (e.g., Happy)">
  <button id="logMoodBtn">Log Mood</button>
  <button id="oracleBtn">‚ú® Daily Oracle</button>
  <button id="gardenBtn">üå± Mood Garden</button>
</div>

<script>
// === Give each user a unique ID ===
let userId = localStorage.getItem('userId');
if (!userId) {
  userId = Math.random().toString(36).substring(2, 10);
  localStorage.setItem('userId', userId);
}

const chatBox = document.getElementById('chatBox');
const userInput = document.getElementById('userInput');
const sendMessageBtn = document.getElementById('sendMessageBtn');
const moodInput = document.getElementById('moodInput');
const logMoodBtn = document.getElementById('logMoodBtn');
const gardenBtn = document.getElementById('gardenBtn');
const oracleBtn = document.getElementById('oracleBtn');

function appendMessage(text,type='bot'){
  const div=document.createElement('div');
  div.className=`message ${type}`;
  div.innerHTML=text;
  chatBox.appendChild(div);
  chatBox.scrollTop=chatBox.scrollHeight;
}

// send message
sendMessageBtn.addEventListener('click', async () => {
  const msg = userInput.value.trim();
  if (!msg) return;
  appendMessage(msg, 'user');
  userInput.value = '';
  try {
    const res = await fetch('/api/chat', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: msg })
    });
    const data = await res.json();
    appendMessage(data.reply, 'bot');
  } catch {
    appendMessage("‚ö†Ô∏è AI is offline", 'bot');
  }
});

// send on Enter
userInput.addEventListener('keypress', (e)=>{
  if(e.key==='Enter'){ e.preventDefault(); sendMessageBtn.click(); }
});

// log mood
logMoodBtn.addEventListener('click', async ()=>{
  const mood = moodInput.value.trim();
  if (!mood) return;
  try {
    const res = await fetch('/api/mood',{
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body:JSON.stringify({ mood, userId })
    });
    const data = await res.json();
    appendMessage(`Mood logged: ${mood} ‚Äî ${data.heartbeat}`,'bot');
    moodInput.value='';
  } catch {
    appendMessage("‚ö†Ô∏è Could not log mood",'bot');
  }
});

// mood garden
gardenBtn.addEventListener('click', async ()=>{
  try {
    const res = await fetch(`/api/moods?userId=${userId}`);
    const data = await res.json();
    appendMessage(`üå± Loaded ${data.moods.length} moods for you.`, 'bot');
  } catch {
    appendMessage("‚ö†Ô∏è Could not load Mood Garden",'bot');
  }
});

// oracle
oracleBtn.addEventListener('click', async ()=>{
  try {
    const res = await fetch('/api/oracle');
    const data = await res.json();
    appendMessage(data.message,'bot');
  } catch {
    appendMessage("‚ö†Ô∏è Oracle unavailable",'bot');
  }
});
</script>
</body>
</html>
